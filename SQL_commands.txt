CREATE DATABASE document_request_system;

USE document_request_system;

=========i-paste sa SQL tab para makagawa database=========================

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    middle_name VARCHAR(50),
    birthday DATE NOT NULL,
    address VARCHAR(255) NOT NULL,
    mobile VARCHAR(20) NOT NULL,
    student_id VARCHAR(20) NOT NULL UNIQUE,
    status ENUM('enrolled', 'graduated', 'did_not_finish') NOT NULL,
    school_year VARCHAR(9) NOT NULL,
    course VARCHAR(100) NOT NULL
);

CREATE TABLE requests (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    document_type VARCHAR(100) NOT NULL,
    file_path VARCHAR(255),
    message TEXT,
    status ENUM('pending', 'verifying', 'for_payment', 'for_pickup', 'released') DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE admins (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);

======kung pano mo lalagyan ng sign in info yung admin kasi wala naman yun registration form========================

INSERT INTO admins (email, password) VALUES ('admin@ptc.com', '$2y$10$y3VpRoNIAf8SEdzjo7IzXOu.S4CahXGGZnd7yGHWVJ.oIZ3TINDE2');

========nilagyan ko ng 'canceled' na status======================

ALTER TABLE requests MODIFY status ENUM('pending', 'verifying', 'for_payment', 'for_pickup', 'released', 'canceled') DEFAULT 'pending';

=========nilagyan ko ng 'for scheduling' na status=================

ALTER TABLE requests MODIFY status ENUM('pending', 'verifying', 'for_payment', 'for_pickup', 'released', 'canceled', 'for_scheduling') DEFAULT 'pending';

======NEW TABLE sa database para sa schedule==================

CREATE TABLE schedule_slots (
    id INT AUTO_INCREMENT PRIMARY KEY,
    date DATE NOT NULL,
    available_slots INT NOT NULL DEFAULT 50
);

====lagyan ng reference id yung mga request=============
ALTER TABLE requests ADD reference_id VARCHAR(20);

======para sa notifications==================
CREATE TABLE notifications (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);


=======para sa conversation=======================
ALTER TABLE requests ADD COLUMN conversation JSON NOT NULL DEFAULT '[]';

=======para sa mga file attachments===========================
ALTER TABLE requests ADD COLUMN attachments JSON NOT NULL DEFAULT '[]';

========storage ng napiling date=============
ALTER TABLE requests ADD COLUMN schedule_date DATE;

========tinanggal ko lang yung underscore sa status=============

ALTER TABLE requests MODIFY status ENUM('pending', 'verifying', 'for payment', 'for pickup', 'released', 'canceled', 'for scheduling') DEFAULT 'pending'

=======add option for 'graduating' students sa database==========
ALTER TABLE users MODIFY status ENUM('enrolled', 'graduating', 'graduated', 'dropped') NOT NULL, DEFAULT 'enrolled';

=======add document types database==========

ALTER TABLE requests ADD COLUMN document_types JSON NOT NULL DEFAULT '[]';

=======add statuses database==========
ALTER TABLE schedule_slots ADD COLUMN statuses JSON NOT NULL DEFAULT '[]';
ALTER TABLE schedule_slots ADD COLUMN document_types JSON NOT NULL DEFAULT '[]';
ALTER TABLE schedule_slots ADD COLUMN courses JSON NOT NULL DEFAULT '[]';

June 22, 2024
=========super admin account============
ALTER TABLE admins ADD COLUMN role ENUM('admin', 'superadmin') DEFAULT 'admin';

UPDATE admins SET role = 'superadmin' WHERE email = 'superadmin@ptc.com';

INSERT INTO admins (email, password,role) VALUES ('superadmin@ptc.com', '$2y$10$EA2jX/JAiIGZ55lo4tOTIOsItU8.HbcIiy/4dn0tpReOSGJZXn1Cq','superadmin');


=========sa mga documents==============
CREATE TABLE document_types (
    id INT AUTO_INCREMENT PRIMARY KEY,
    type VARCHAR(255) NOT NULL
);

INSERT INTO document_types (type) VALUES 
('Transcript of Records'),
('Transfer Credentials (TOR, Honorable Dismissal, Certificate of Good Moral Character, Certificate of Grades, Certificate of Transfer)'),
('Diploma'),
('Certificate of Transfer'),
('Certificate of Enrollment/Registration'),
('Certificate of Grade'),
('Certificate of Honorable Dismissal'),
('Certificate of Graduation'),
('Certificate of General Weighted Average'),
('Certificate of Study Load'),
('Certification-Authentication-Verification (CAV) of Grades of TOR/Diploma (CTC)'),
('Certification of Good Moral Character'),
('Certified True Copy of Transcript of Record'),
('Certified True Copy of Diploma'),
('Certified True Copy of Certificate of Good Moral Character'),
('Certified True Copy of Certificate of Graduation'),
('Certified True Copy of Certificate of General Weighted Average'),
('Form 138 A (CTC)'),
('Form 137');


================

ALTER TABLE requests ADD COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;

==========history log============

CREATE TABLE history_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    admin_id INT NOT NULL,
    activity VARCHAR(255) NOT NULL,
    reference_id VARCHAR(20),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (admin_id) REFERENCES admins(id)
);

ALTER TABLE requests ADD COLUMN created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;

